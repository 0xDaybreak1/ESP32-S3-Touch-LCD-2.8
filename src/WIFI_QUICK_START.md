# WiFi 图片传输快速使用指南

## 🚀 快速开始

### 1. 编译并上传固件

```bash
# 在项目根目录执行
pio run -t upload
```

### 2. 连接 WiFi

开发板启动后会自动创建 WiFi 热点：

- **SSID**: `ESP32-ImageDisplay`
- **密码**: `12345678`
- **IP 地址**: `192.168.4.1`

使用手机或电脑连接到此热点。

### 3. 访问 Web 控制台

在浏览器中打开以下任一地址：

- `http://vision.local` (推荐，支持 mDNS 的设备)
- `http://192.168.4.1` (直接 IP 访问)

### 4. 上传图片

在 Web 界面中：

1. 点击上传区域或拖拽图片文件
2. 支持的格式：JPEG、PNG、BMP
3. 等待上传完成（显示进度条）
4. 上传成功后图片会出现在图片库中

### 5. 显示图片

- 点击图片卡片上的 "📺 显示" 按钮
- 图片会立即在开发板屏幕上显示
- 也可以让系统自动轮播本地图片

### 6. 删除图片

- 点击图片卡片上的 "🗑️ 删除" 按钮
- 确认后图片会从 SD 卡中删除

---

## 📱 功能说明

### 图片上传
- 支持单个或多个文件同时上传
- 支持拖拽上传
- 实时显示上传进度
- 自动保存到 SD 卡 `/uploaded/` 目录

### 图片管理
- 自动列出所有已上传的图片
- 点击显示按钮可立即在屏幕上查看
- 支持删除不需要的图片

### RGB 灯珠控制（预留）
- 颜色选择器：选择 LED 颜色
- 亮度调节：0-100% 亮度控制
- 模式切换：常亮、流水灯、呼吸灯、关闭

---

## 🔧 高级配置

### 修改 WiFi 配置

编辑 `src/WebServer_Driver.h` 文件：

```cpp
#define WIFI_AP_SSID        "你的热点名称"
#define WIFI_AP_PASSWORD    "你的密码"
#define MDNS_HOSTNAME       "你的域名"
```

### 修改上传目录

编辑 `src/WebServer_Driver.h` 文件：

```cpp
#define UPLOAD_DIR          "/你的目录"
```

---

## ⚠️ 注意事项

1. **SD 卡要求**
   - 必须插入 SD 卡才能使用上传功能
   - 建议使用 Class 10 或更高速度的 SD 卡
   - 确保 SD 卡有足够的剩余空间

2. **文件大小限制**
   - 建议单个文件不超过 10MB
   - 过大的文件可能导致上传超时

3. **网络稳定性**
   - 上传大文件时保持设备与开发板距离较近
   - 避免在上传过程中断开 WiFi 连接

4. **浏览器兼容性**
   - 推荐使用 Chrome、Edge、Safari 等现代浏览器
   - 部分旧版浏览器可能不支持拖拽上传

---

## 🐛 故障排查

### 无法连接 WiFi 热点

**问题**: 找不到 `ESP32-ImageDisplay` 热点

**解决方案**:
1. 检查开发板是否正常启动（查看串口日志）
2. 重启开发板
3. 检查 WiFi 是否被其他设备占用

### 无法访问 Web 界面

**问题**: 浏览器无法打开 `http://192.168.4.1`

**解决方案**:
1. 确认已连接到开发板的 WiFi 热点
2. 尝试使用 IP 地址而非域名访问
3. 清除浏览器缓存
4. 检查防火墙设置

### 上传失败

**问题**: 图片上传时显示错误

**解决方案**:
1. 检查 SD 卡是否正常插入
2. 检查 SD 卡剩余空间
3. 确认文件格式为 JPEG/PNG/BMP
4. 尝试上传较小的文件测试
5. 查看串口日志获取详细错误信息

### 图片无法显示

**问题**: 点击显示按钮后屏幕无反应

**解决方案**:
1. 检查图片文件是否损坏
2. 尝试重新上传图片
3. 查看串口日志获取解码错误信息
4. 确认图片分辨率不超过屏幕尺寸

---

## 📊 系统状态监控

### 串口日志

连接串口（波特率 115200）可查看详细日志：

```
========== WiFi 初始化 ==========
✓ SD 卡互斥锁创建成功
✓ 创建上传目录: /uploaded
✓ AP 模式已启动
  SSID: ESP32-ImageDisplay
  密码: 12345678
  IP 地址: 192.168.4.1
✓ mDNS 服务已启动
  访问地址: http://vision.local
✓ Web 服务器已启动
==================================
```

### 上传日志示例

```
--- 开始上传文件: test.jpg ---
  已上传: 100 KB
  已上传: 200 KB
  已上传: 300 KB
✓ 上传完成: test.jpg (345678 字节)
```

---

## 📞 技术支持

如遇到问题，请提供以下信息：

1. 开发板型号：ESP32-S3
2. 固件版本：查看串口启动日志
3. 错误现象描述
4. 串口完整日志
5. 使用的浏览器和操作系统

---

**文档版本**: v1.0  
**创建时间**: 2026-02-22  
**创建者**: Kiro
